import React, { useState } from 'react';
import { Send, ArrowLeft, AlertCircle } from 'lucide-react';

export default function StudyCafeInquiry() {
  const [page, setPage] = useState('branch');
  const [selectedBranch, setSelectedBranch] = useState('');
  const [selectedType, setSelectedType] = useState('');
  const [seatNumber, setSeatNumber] = useState('');
  const [inquiryContent, setInquiryContent] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [submitStatus, setSubmitStatus] = useState('');

  const TELEGRAM_BOT_TOKEN = 'YOUR_BOT_TOKEN_HERE';
  const TELEGRAM_CHAT_ID = 'YOUR_CHAT_ID_HERE';

  const branches = [
    { id: 'gyeyang', name: 'ì¸ì²œê³„ì–‘ë³¸ì ', icon: 'ğŸ¢' },
    { id: 'bakchon', name: 'ì¸ì²œë°•ì´Œì—­ì ', icon: 'ğŸš‡' },
    { id: 'bupyeong', name: 'ë¶€í‰ì‚¼ì‚°ì ', icon: 'ğŸ™ï¸' },
    { id: 'sangdong', name: 'ë¶€ì²œìƒë™ì ', icon: 'ğŸª' },
    { id: 'sinjung', name: 'ë¶€ì²œì‹ ì¤‘ë™ì ', icon: 'ğŸ¬' }
  ];

  const inquiryTypes = [
    { id: 'room', title: 'ìŠ¤í„°ë””ë£¸ ì˜ˆì•½', icon: 'ğŸ“…' },
    { id: 'report', title: 'í•™ìŠµ ë°©í•´ í–‰ìœ„ ì‹ ê³ ', icon: 'ğŸš¨' },
    { id: 'temperature', title: 'ì˜¨ë„ ì¡°ì ˆ ë¬¸ì˜', icon: 'ğŸŒ¡ï¸' },
    { id: 'parking', title: 'ì£¼ì°¨ ë¬¸ì˜', icon: 'ğŸš—' },
    { id: 'other', title: 'ê·¸ ì™¸ ê¸°íƒ€ ë¬¸ì˜', icon: 'ğŸ’¬' }
  ];

  const handleBranchSelect = (branch) => {
    setSelectedBranch(branch);
    setPage('type');
  };

  const handleTypeSelect = (type) => {
    setSelectedType(type);
    setPage('form');
  };

  const handleSubmit = async () => {
    if (!seatNumber || !inquiryContent) {
      setSubmitStatus('error');
      return;
    }

    setIsSubmitting(true);
    setSubmitStatus('');

    const selectedBranchInfo = branches.find(b => b.id === selectedBranch);
    const selectedTypeInfo = inquiryTypes.find(t => t.id === selectedType);
    const message = `
ğŸ¢ ì—ë¸Œë¼ì„ ìŠ¤í„°ë””ì¹´í˜ ë¬¸ì˜

ğŸ“ ì§€ì : ${selectedBranchInfo.icon} ${selectedBranchInfo.name}
ğŸ“‹ ë¬¸ì˜ ìœ í˜•: ${selectedTypeInfo.icon} ${selectedTypeInfo.title}
ğŸ’º ì¢Œì„ ë²ˆí˜¸: ${seatNumber}ë²ˆ
ğŸ“ ë¬¸ì˜ ë‚´ìš©:
${inquiryContent}

â° ì ‘ìˆ˜ ì‹œê°„: ${new Date().toLocaleString('ko-KR')}
    `.trim();

    try {
      const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          chat_id: TELEGRAM_CHAT_ID,
          text: message,
          parse_mode: 'HTML'
        })
      });

      if (response.ok) {
        setSubmitStatus('success');
        setTimeout(() => {
          setSeatNumber('');
          setInquiryContent('');
          setSelectedBranch('');
          setSelectedType('');
          setPage('branch');
          setSubmitStatus('');
        }, 2000);
      } else {
        setSubmitStatus('error');
      }
    } catch (error) {
      console.error('Error:', error);
      setSubmitStatus('error');
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleBackToBranch = () => {
    setPage('branch');
    setSelectedBranch('');
    setSelectedType('');
    setSeatNumber('');
    setInquiryContent('');
    setSubmitStatus('');
  };

  const handleBackToType = () => {
    setPage('type');
    setSeatNumber('');
    setInquiryContent('');
    setSubmitStatus('');
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
      <div className="max-w-2xl mx-auto">
        
        {/* í—¤ë” */}
        <div className="bg-white rounded-t-2xl shadow-lg p-6 mt-8">
          <h1 className="text-3xl font-bold text-center text-indigo-900">
            ì—ë¸Œë¼ì„ ìŠ¤í„°ë””ì¹´í˜
          </h1>
          <p className="text-center text-gray-600 mt-2">ì§ì˜ì  ë¬¸ì˜ ì‹œìŠ¤í…œ</p>
        </div>

        {/* 1í˜ì´ì§€: ì§ì˜ì  ì„ íƒ */}
        {page === 'branch' && (
          <div className="bg-white rounded-b-2xl shadow-lg p-6">
            <h2 className="text-xl font-semibold text-gray-800 mb-4">
              ì§ì˜ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”
            </h2>
            <div className="space-y-3">
              {branches.map((branch) => (
                <button
                  key={branch.id}
                  onClick={() => handleBranchSelect(branch.id)}
                  className="w-full p-4 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white rounded-xl shadow-md transition-all transform hover:scale-105 flex items-center justify-between"
                >
                  <span className="text-lg font-medium">{branch.name}</span>
                  <span className="text-2xl">{branch.icon}</span>
                </button>
              ))}
            </div>
          </div>
        )}

        {/* 2í˜ì´ì§€: ë¬¸ì˜ ìœ í˜• ì„ íƒ */}
        {page === 'type' && (
          <div className="bg-white rounded-b-2xl shadow-lg p-6">
            <button
              onClick={handleBackToBranch}
              className="flex items-center text-indigo-600 hover:text-indigo-800 mb-4"
            >
              <ArrowLeft size={20} className="mr-1" />
              ì§ì˜ì  ë‹¤ì‹œ ì„ íƒ
            </button>

            <div className="bg-indigo-50 rounded-lg p-3 mb-4">
              <p className="text-sm text-indigo-800">
                ì„ íƒí•œ ì§€ì : <span className="font-semibold">
                  {branches.find(b => b.id === selectedBranch)?.name}
                </span>
              </p>
            </div>

            <h2 className="text-xl font-semibold text-gray-800 mb-4">
              ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?
            </h2>
            <div className="space-y-3">
              {inquiryTypes.map((type) => (
                <button
                  key={type.id}
                  onClick={() => handleTypeSelect(type.id)}
                  className="w-full p-4 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white rounded-xl shadow-md transition-all transform hover:scale-105 flex items-center justify-between"
                >
                  <span className="text-lg font-medium">{type.title}</span>
                  <span className="text-2xl">{type.icon}</span>
                </button>
              ))}
            </div>
          </div>
        )}

        {/* 3í˜ì´ì§€: ë¬¸ì˜ í¼ */}
        {page === 'form' && (
          <div className="bg-white rounded-b-2xl shadow-lg p-6">
            <button
              onClick={handleBackToType}
              className="flex items-center text-indigo-600 hover:text-indigo-800 mb-4"
            >
              <ArrowLeft size={20} className="mr-1" />
              ë¬¸ì˜ ìœ í˜• ë‹¤ì‹œ ì„ íƒ
            </button>

            <div className="bg-indigo-50 rounded-lg p-3 mb-4 space-y-1">
              <p className="text-sm text-indigo-800">
                ì§€ì : <span className="font-semibold">
                  {branches.find(b => b.id === selectedBranch)?.name}
                </span>
              </p>
              <p className="text-sm text-indigo-800">
                ë¬¸ì˜ ìœ í˜•: <span className="font-semibold">
                  {inquiryTypes.find(t => t.id === selectedType)?.title}
                </span>
              </p>
            </div>

            <h2 className="text-xl font-semibold text-gray-800 mb-4">
              {inquiryTypes.find(t => t.id === selectedType)?.icon}{' '}
              {inquiryTypes.find(t => t.id === selectedType)?.title}
            </h2>

            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  ì¢Œì„ ë²ˆí˜¸
                </label>
                <input
                  type="text"
                  value={seatNumber}
                  onChange={(e) => setSeatNumber(e.target.value)}
                  placeholder="ì˜ˆ: 42"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  ë¬¸ì˜ ë‚´ìš©
                </label>
                <textarea
                  value={inquiryContent}
                  onChange={(e) => setInquiryContent(e.target.value)}
                  placeholder="ë¬¸ì˜í•˜ì‹¤ ë‚´ìš©ì„ ìƒì„¸íˆ ì…ë ¥í•´ì£¼ì„¸ìš”"
                  rows="6"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"
                />
              </div>

              {submitStatus === 'error' && (
                <div className="bg-red-50 border border-red-200 rounded-lg p-3 flex items-center text-red-700">
                  <AlertCircle size={20} className="mr-2" />
                  <span>ë¬¸ì˜ ì ‘ìˆ˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</span>
                </div>
              )}

              {submitStatus === 'success' && (
                <div className="bg-green-50 border border-green-200 rounded-lg p-3 flex items-center text-green-700">
                  <span>âœ… ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!</span>
                </div>
              )}

              <button
                onClick={handleSubmit}
                disabled={isSubmitting}
                className="w-full bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {isSubmitting ? (
                  'ì „ì†¡ ì¤‘...'
                ) : (
                  <>
                    <Send size={20} className="mr-2" />
                    ë¬¸ì˜í•˜ê¸°
                  </>
                )}
              </button>
            </div>
          </div>
        )}

        {/* í‘¸í„° */}
        <div className="text-center mt-6 text-gray-600 text-sm">
          <p>ë¬¸ì˜í•˜ì‹  ë‚´ìš©ì€ ì‹¤ì‹œê°„ìœ¼ë¡œ ê´€ë¦¬ìì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤</p>
          <p className="mt-1">ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤ ğŸ˜Š</p>
        </div>
      </div>
    </div>
  );
}

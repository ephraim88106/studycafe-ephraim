<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ì—ë¸Œë¼ì„ ìŠ¤í„°ë””ì¹´í˜ - ì§ì˜ì  ë¬¸ì˜</title>
  <meta name="description" content="ì—ë¸Œë¼ì„ ìŠ¤í„°ë””ì¹´í˜ ì§ì˜ì  ë¬¸ì˜ ë° ì˜ˆì•½ ì‹œìŠ¤í…œ" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
  <div class="max-w-2xl mx-auto">
    <!-- í—¤ë” -->
    <div class="bg-white rounded-t-2xl shadow-lg p-6 mt-8">
      <h1 class="text-3xl font-bold text-center text-indigo-900">ì—ë¸Œë¼ì„ ìŠ¤í„°ë””ì¹´í˜</h1>
      <p class="text-center text-gray-600 mt-2">ì§ì˜ì  ë¬¸ì˜ ì‹œìŠ¤í…œ</p>
    </div>

    <!-- ì§€ì  ì„ íƒ í˜ì´ì§€ -->
    <div id="page-branch" class="bg-white rounded-b-2xl shadow-lg p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">ì§ì˜ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
      <div class="space-y-3" role="list">
        <button onclick="app.selectBranch('gyeyang','ì¸ì²œê³„ì–‘ë³¸ì ','ğŸ¢')" class="branch-btn" role="listitem">
          <span class="text-lg font-medium">ì¸ì²œê³„ì–‘ë³¸ì </span><span class="text-2xl" aria-hidden="true">ğŸ¢</span>
        </button>
        <button onclick="app.selectBranch('bakchon','ì¸ì²œë°•ì´Œì—­ì ','ğŸš‡')" class="branch-btn" role="listitem">
          <span class="text-lg font-medium">ì¸ì²œë°•ì´Œì—­ì </span><span class="text-2xl" aria-hidden="true">ğŸš‡</span>
        </button>
        <button onclick="app.selectBranch('bupyeong','ë¶€í‰ì‚¼ì‚°ì ','ğŸ™ï¸')" class="branch-btn" role="listitem">
          <span class="text-lg font-medium">ë¶€í‰ì‚¼ì‚°ì </span><span class="text-2xl" aria-hidden="true">ğŸ™ï¸</span>
        </button>
        <button onclick="app.selectBranch('sangdong','ë¶€ì²œìƒë™ì ','ğŸª')" class="branch-btn" role="listitem">
          <span class="text-lg font-medium">ë¶€ì²œìƒë™ì </span><span class="text-2xl" aria-hidden="true">ğŸª</span>
        </button>
        <button onclick="app.selectBranch('sinjung','ë¶€ì²œì‹ ì¤‘ë™ì ','ğŸ¬')" class="branch-btn" role="listitem">
          <span class="text-lg font-medium">ë¶€ì²œì‹ ì¤‘ë™ì </span><span class="text-2xl" aria-hidden="true">ğŸ¬</span>
        </button>
      </div>
    </div>

    <!-- ë¬¸ì˜ ìœ í˜• ì„ íƒ í˜ì´ì§€ -->
    <div id="page-type" class="bg-white rounded-b-2xl shadow-lg p-6 hidden">
      <button onclick="app.goToPage('branch')" class="back-btn mb-4" aria-label="ì§ì˜ì  ë‹¤ì‹œ ì„ íƒ">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>ì§ì˜ì  ë‹¤ì‹œ ì„ íƒ
      </button>
      <div class="bg-indigo-50 rounded-lg p-3 mb-4">
        <p class="text-sm text-indigo-800">ì„ íƒí•œ ì§€ì : <span id="selected-branch-name" class="font-semibold"></span></p>
      </div>
      <h2 class="text-xl font-semibold text-gray-800 mb-4">ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</h2>
      <div id="inquiry-types" class="space-y-3" role="list"></div>
      <button onclick="app.goToPage('branch')" class="btn-secondary w-full mt-4">ì·¨ì†Œ</button>
    </div>

    <!-- ì¸ì²œê³„ì–‘ë³¸ì  ì£¼ì°¨ ì•ˆë‚´ í˜ì´ì§€ -->
    <div id="page-parking-info-gyeyang" class="bg-white rounded-b-2xl shadow-lg p-6 hidden">
      <button onclick="app.goToPage('type')" class="back-btn mb-4" aria-label="ë’¤ë¡œê°€ê¸°">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>ë’¤ë¡œê°€ê¸°
      </button>
      <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg" role="alert">
        <div class="flex items-start">
          <span class="text-4xl mr-4" aria-hidden="true">ğŸ…¿ï¸</span>
          <div>
            <h3 class="text-xl font-bold text-blue-900 mb-3">ì¸ì²œê³„ì–‘ë³¸ì  ì£¼ì°¨ ì•ˆë‚´</h3>
            <p class="text-gray-700 text-lg leading-relaxed">
              ì§€í•˜ì£¼ì°¨ì¥ì´ ìˆìœ¼ë‚˜ í˜‘ì†Œí•˜ë‹ˆ ì°¸ê³ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
            </p>
          </div>
        </div>
      </div>
      <div class="flex gap-3 mt-6">
        <button onclick="app.goToPage('type')" class="btn-secondary flex-1">ì·¨ì†Œ</button>
        <button onclick="app.goToPage('branch')" class="btn-primary flex-1">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>

    <!-- ì¸ì²œë°•ì´Œì—­ì  ì£¼ì°¨ ì•ˆë‚´ í˜ì´ì§€ -->
    <div id="page-parking-info-bakchon" class="bg-white rounded-b-2xl shadow-lg p-6 hidden">
      <button onclick="app.goToPage('type')" class="back-btn mb-4" aria-label="ë’¤ë¡œê°€ê¸°">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>ë’¤ë¡œê°€ê¸°
      </button>
      <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg" role="alert">
        <div class="flex items-start">
          <span class="text-4xl mr-4" aria-hidden="true">ğŸ…¿ï¸</span>
          <div>
            <h3 class="text-xl font-bold text-blue-900 mb-3">ì¸ì²œë°•ì´Œì—­ì  ì£¼ì°¨ ì•ˆë‚´</h3>
            <p class="text-gray-700 text-lg leading-relaxed">
              ë’·í¸ì— ì£¼ì°¨ì¥ì´ ìˆìœ¼ë‚˜ í˜‘ì†Œí•˜ë‹ˆ ì°¸ê³ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
            </p>
          </div>
        </div>
      </div>
      <div class="flex gap-3 mt-6">
        <button onclick="app.goToPage('type')" class="btn-secondary flex-1">ì·¨ì†Œ</button>
        <button onclick="app.goToPage('branch')" class="btn-primary flex-1">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>

    <!-- ë¶€í‰ì‚¼ì‚°ì  ì£¼ì°¨ ì•ˆë‚´ í˜ì´ì§€ -->
    <div id="page-parking-info-bupyeong" class="bg-white rounded-b-2xl shadow-lg p-6 hidden">
      <button onclick="app.goToPage('type')" class="back-btn mb-4" aria-label="ë’¤ë¡œê°€ê¸°">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>ë’¤ë¡œê°€ê¸°
      </button>
      <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg" role="alert">
        <div class="flex items-start">
          <span class="text-4xl mr-4" aria-hidden="true">ğŸ…¿ï¸</span>
          <div>
            <h3 class="text-xl font-bold text-blue-900 mb-3">ë¶€í‰ì‚¼ì‚°ì  ì£¼ì°¨ ì•ˆë‚´</h3>
            <p class="text-gray-700 text-lg leading-relaxed">
              ì•„íŒŒíŠ¸ ìƒê°€ì— ì£¼ì°¨ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ, ë¶ˆê°€í•œ ê²½ìš°ë„ ìˆìœ¼ë‹ˆ ì°¸ê³  ë°”ëë‹ˆë‹¤.
            </p>
          </div>
        </div>
      </div>
      <div class="flex gap-3 mt-6">
        <button onclick="app.goToPage('type')" class="btn-secondary flex-1">ì·¨ì†Œ</button>
        <button onclick="app.goToPage('branch')" class="btn-primary flex-1">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>

    <!-- ë¬¸ì˜ í¼ í˜ì´ì§€ -->
    <div id="page-form" class="bg-white rounded-b-2xl shadow-lg p-6 hidden">
      <button onclick="app.goToPage('type')" class="back-btn mb-4" aria-label="ë¬¸ì˜ ìœ í˜• ë‹¤ì‹œ ì„ íƒ">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>ë¬¸ì˜ ìœ í˜• ë‹¤ì‹œ ì„ íƒ
      </button>
      <div class="bg-indigo-50 rounded-lg p-3 mb-4 space-y-1">
        <p class="text-sm text-indigo-800">ì§€ì : <span id="form-branch-name" class="font-semibold"></span></p>
        <p class="text-sm text-indigo-800">ë¬¸ì˜ ìœ í˜•: <span id="form-type-name" class="font-semibold"></span></p>
      </div>
      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        <span id="form-type-icon" aria-hidden="true"></span> <span id="form-type-title"></span>
      </h2>
      <form id="inquiry-form" class="space-y-4" onsubmit="event.preventDefault(); app.submitInquiry();">
        <div>
          <label for="seat-number" class="block text-sm font-medium text-gray-700 mb-2">ì¢Œì„ ë²ˆí˜¸ <span class="text-red-500">*</span></label>
          <input type="number" id="seat-number" name="seatNumber" inputmode="numeric" min="1" max="500"
                 placeholder="ì˜ˆ: 42"
                 class="input" required aria-required="true" aria-describedby="seat-help" />
          <p id="seat-help" class="text-xs text-gray-500 mt-1">1~500 ì‚¬ì´ ìˆ«ì</p>
        </div>
        <div>
          <label for="inquiry-content" class="block text-sm font-medium text-gray-700 mb-2">ë¬¸ì˜ ë‚´ìš© <span class="text-red-500">*</span></label>
          <textarea id="inquiry-content" name="content" rows="6" maxlength="1000"
                    placeholder="ë¬¸ì˜í•˜ì‹¤ ë‚´ìš©ì„ ìƒì„¸íˆ ì…ë ¥í•´ì£¼ì„¸ìš” (ìµœëŒ€ 1000ì)"
                    class="input resize-none" required aria-required="true" aria-describedby="content-help"></textarea>
          <p id="content-help" class="text-xs text-gray-500 mt-1"><span id="content-count">0</span>/1000</p>
        </div>
        <div id="live-region" class="sr-only" aria-live="polite" aria-atomic="true"></div>
        <div id="error-message" class="alert alert-error hidden" role="alert">
          <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span id="error-text">ë¬¸ì˜ ì ‘ìˆ˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</span>
        </div>
        <div id="success-message" class="alert alert-success hidden" role="alert">
          <span>âœ… ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!</span>
        </div>
        <button id="submit-button" type="submit" class="btn-primary w-full">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
          </svg>
          ë¬¸ì˜í•˜ê¸°
        </button>
        <button type="button" onclick="app.goToPage('type')" class="btn-secondary w-full">ì·¨ì†Œ</button>
      </form>
    </div>

    <!-- í‘¸í„° -->
    <div class="text-center mt-6 text-gray-600 text-sm">
      <p>ë¬¸ì˜í•˜ì‹  ë‚´ìš©ì€ ì‹¤ì‹œê°„ìœ¼ë¡œ ê´€ë¦¬ìì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤</p>
      <p class="mt-1">ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤ ğŸ˜Š</p>
    </div>
  </div>

  <style>
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }
  </style>

  <script>
    // ì• í”Œë¦¬ì¼€ì´ì…˜ ê°ì²´ (ì „ì—­ ìŠ¤ì½”í”„ ì˜¤ì—¼ ìµœì†Œí™”)
    const app = (() => {
      // CSS í´ë˜ìŠ¤ ì •ì˜
      const CSS_CLASSES = {
        primary: 'w-full p-4 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white rounded-xl shadow-md transition-all transform hover:scale-105 flex items-center justify-between focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2',
        btnPrimary: 'bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2',
        btnSecondary: 'bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 px-6 rounded-lg shadow-md transition-all focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2',
        backBtn: 'flex items-center text-indigo-600 hover:text-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded',
        input: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all',
        alertErr: 'bg-red-50 border border-red-200 rounded-lg p-3 flex items-center text-red-700',
        alertOk: 'bg-green-50 border border-green-200 rounded-lg p-3 flex items-center text-green-700'
      };

      // ë¬¸ì˜ ìœ í˜• ì •ì˜
      const INQUIRY_TYPES = [
        { id: 'room', title: 'ìŠ¤í„°ë””ë£¸ ì˜ˆì•½', icon: 'ğŸ“…' },
        { id: 'report', title: 'í•™ìŠµ ë°©í•´ í–‰ìœ„ ì‹ ê³ ', icon: 'ğŸš¨' },
        { id: 'parking', title: 'ì£¼ì°¨ ë¬¸ì˜', icon: 'ğŸš—', excludeBranches: ['bupyeong', 'gyeyang', 'bakchon'] },
        { id: 'parking_info_gyeyang', title: 'ì£¼ì°¨ ì•ˆë‚´', icon: 'ğŸ…¿ï¸', onlyBranches: ['gyeyang'], isInfo: true, infoPage: 'parking-info-gyeyang' },
        { id: 'parking_info_bakchon', title: 'ì£¼ì°¨ ì•ˆë‚´', icon: 'ğŸ…¿ï¸', onlyBranches: ['bakchon'], isInfo: true, infoPage: 'parking-info-bakchon' },
        { id: 'parking_info_bupyeong', title: 'ì£¼ì°¨ ì•ˆë‚´', icon: 'ğŸ…¿ï¸', onlyBranches: ['bupyeong'], isInfo: true, infoPage: 'parking-info-bupyeong' },
        { id: 'temperature', title: 'ì˜¨ë„ ì¡°ì ˆ ë¬¸ì˜', icon: 'ğŸŒ¡ï¸' },
        { id: 'other', title: 'ê·¸ ì™¸ ê¸°íƒ€ ë¬¸ì˜', icon: 'ğŸ’¬' }
      ];

      // ìƒíƒœ ê´€ë¦¬
      const state = {
        selectedBranch: '',
        selectedBranchName: '',
        selectedType: '',
        selectedTypeName: '',
        selectedTypeIcon: '',
        isSubmitting: false
      };

      // DOM ìš”ì†Œ ìºì‹±
      const elements = {
        pages: {},
        form: {
          seatNumber: null,
          content: null,
          contentCount: null,
          submitButton: null
        },
        messages: {
          error: null,
          errorText: null,
          success: null,
          liveRegion: null
        }
      };

      // ì´ˆê¸°í™”
      function init() {
        cacheElements();
        applyStyles();
        setupEventListeners();
      }

      // DOM ìš”ì†Œ ìºì‹±
      function cacheElements() {
        elements.pages = {
          branch: document.getElementById('page-branch'),
          type: document.getElementById('page-type'),
          form: document.getElementById('page-form'),
          parkingInfoGyeyang: document.getElementById('page-parking-info-gyeyang'),
          parkingInfoBakchon: document.getElementById('page-parking-info-bakchon'),
          parkingInfoBupyeong: document.getElementById('page-parking-info-bupyeong')
        };

        elements.form = {
          seatNumber: document.getElementById('seat-number'),
          content: document.getElementById('inquiry-content'),
          contentCount: document.getElementById('content-count'),
          submitButton: document.getElementById('submit-button')
        };

        elements.messages = {
          error: document.getElementById('error-message'),
          errorText: document.getElementById('error-text'),
          success: document.getElementById('success-message'),
          liveRegion: document.getElementById('live-region')
        };
      }

      // ìŠ¤íƒ€ì¼ ì ìš©
      function applyStyles() {
        document.querySelectorAll('.branch-btn').forEach(el => el.className = CSS_CLASSES.primary);
        document.querySelectorAll('.btn-primary').forEach(el => el.className = CSS_CLASSES.btnPrimary);
        document.querySelectorAll('.btn-secondary').forEach(el => el.className = CSS_CLASSES.btnSecondary);
        document.querySelectorAll('.back-btn').forEach(el => el.className = CSS_CLASSES.backBtn);
        document.querySelectorAll('.input').forEach(el => el.className = CSS_CLASSES.input);
        
        if (elements.messages.error) {
          elements.messages.error.className = CSS_CLASSES.alertErr + ' hidden';
        }
        if (elements.messages.success) {
          elements.messages.success.className = CSS_CLASSES.alertOk + ' hidden';
        }
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      function setupEventListeners() {
        if (elements.form.content) {
          elements.form.content.addEventListener('input', updateCounter);
        }

        // ESC í‚¤ë¡œ ë’¤ë¡œê°€ê¸°
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            const currentPage = getCurrentPage();
            if (currentPage === 'type') goToPage('branch');
            else if (currentPage === 'form' || currentPage === 'parkingInfoGyeyang' || currentPage === 'parkingInfoBakchon' || currentPage === 'parkingInfoBupyeong') goToPage('type');
          }
        });
      }

      // í˜„ì¬ í˜ì´ì§€ í™•ì¸
      function getCurrentPage() {
        for (const [key, element] of Object.entries(elements.pages)) {
          if (element && !element.classList.contains('hidden')) {
            return key;
          }
        }
        return null;
      }

      // í˜ì´ì§€ ì „í™˜
      function goToPage(page) {
        // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
        Object.values(elements.pages).forEach(el => {
          if (el) el.classList.add('hidden');
        });

        // ì„ íƒí•œ í˜ì´ì§€ í‘œì‹œ
        if (page === 'branch') {
          elements.pages.branch?.classList.remove('hidden');
          resetState();
        } else if (page === 'type') {
          elements.pages.type?.classList.remove('hidden');
          resetForm();
        } else if (page === 'form') {
          elements.pages.form?.classList.remove('hidden');
          setTimeout(() => elements.form.seatNumber?.focus(), 100);
        } else if (page === 'parking-info-gyeyang') {
          elements.pages.parkingInfoGyeyang?.classList.remove('hidden');
        } else if (page === 'parking-info-bakchon') {
          elements.pages.parkingInfoBakchon?.classList.remove('hidden');
        } else if (page === 'parking-info-bupyeong') {
          elements.pages.parkingInfoBupyeong?.classList.remove('hidden');
        }

        // í˜ì´ì§€ ìµœìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      // ìƒíƒœ ì´ˆê¸°í™”
      function resetState() {
        state.selectedBranch = '';
        state.selectedBranchName = '';
        state.selectedType = '';
        state.selectedTypeName = '';
        state.selectedTypeIcon = '';
      }

      // í¼ ì´ˆê¸°í™”
      function resetForm() {
        if (elements.form.seatNumber) elements.form.seatNumber.value = '';
        if (elements.form.content) {
          elements.form.content.value = '';
          updateCounter();
        }
        hideMessage(elements.messages.error);
        hideMessage(elements.messages.success);
      }

      // ì§€ì  ì„ íƒ
      function selectBranch(id, name, icon) {
        state.selectedBranch = id;
        state.selectedBranchName = name;

        const nameElement = document.getElementById('selected-branch-name');
        if (nameElement) nameElement.textContent = name;

        renderInquiryTypes(id);
        goToPage('type');
      }

      // ë¬¸ì˜ ìœ í˜• ë Œë”ë§
      function renderInquiryTypes(branchId) {
        const container = document.getElementById('inquiry-types');
        if (!container) return;

        container.innerHTML = '';

        INQUIRY_TYPES.forEach(type => {
          // ì§€ì ë³„ í•„í„°ë§
          if (type.excludeBranches?.includes(branchId)) return;
          if (type.onlyBranches && !type.onlyBranches.includes(branchId)) return;

          const button = document.createElement('button');
          button.className = CSS_CLASSES.primary;
          button.setAttribute('type', 'button');
          button.setAttribute('role', 'listitem');
          button.setAttribute('aria-label', type.title);
          button.innerHTML = `<span class="text-lg font-medium">${type.title}</span><span class="text-2xl" aria-hidden="true">${type.icon}</span>`;

          if (type.isInfo) {
            button.onclick = () => goToPage(type.infoPage);
          } else {
            button.onclick = () => selectType(type.id, type.title, type.icon);
          }

          container.appendChild(button);
        });
      }

      // ë¬¸ì˜ ìœ í˜• ì„ íƒ
      function selectType(id, title, icon) {
        state.selectedType = id;
        state.selectedTypeName = title;
        state.selectedTypeIcon = icon;

        document.getElementById('form-branch-name').textContent = state.selectedBranchName;
        document.getElementById('form-type-name').textContent = title;
        document.getElementById('form-type-icon').textContent = icon;
        document.getElementById('form-type-title').textContent = title;

        goToPage('form');
      }

      // ê¸€ììˆ˜ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
      function updateCounter() {
        if (elements.form.content && elements.form.contentCount) {
          elements.form.contentCount.textContent = elements.form.content.value.length;
        }
      }

      // ë©”ì‹œì§€ í‘œì‹œ
      function showMessage(element, text) {
        if (!element) return;
        
        element.classList.remove('hidden');
        
        if (text && elements.messages.errorText && element === elements.messages.error) {
          elements.messages.errorText.textContent = text;
        }

        // ìŠ¤í¬ë¦° ë¦¬ë”ì— ì•Œë¦¼
        if (elements.messages.liveRegion) {
          elements.messages.liveRegion.textContent = element === elements.messages.error 
            ? `ì˜¤ë¥˜: ${text || 'ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}` 
            : 'ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.';
        }
      }

      // ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
      function hideMessage(element) {
        if (element) element.classList.add('hidden');
      }

      // ì…ë ¥ê°’ ê²€ì¦
      function validateInput(seatNumber, content) {
        if (!Number.isInteger(seatNumber) || seatNumber < 1 || seatNumber > 500) {
          return { valid: false, message: 'ì¢Œì„ ë²ˆí˜¸ëŠ” 1~500 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.', field: 'seat' };
        }

        if (content.length < 5) {
          return { valid: false, message: 'ë¬¸ì˜ ë‚´ìš©ì€ ìµœì†Œ 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.', field: 'content' };
        }

        if (content.length > 1000) {
          return { valid: false, message: 'ë¬¸ì˜ ë‚´ìš©ì€ ìµœëŒ€ 1000ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.', field: 'content' };
        }

        return { valid: true };
      }

      // ë¬¸ì˜ ì œì¶œ
      async function submitInquiry() {
        if (state.isSubmitting) return;

        hideMessage(elements.messages.error);
        hideMessage(elements.messages.success);

        const seatNumber = Number(elements.form.seatNumber?.value);
        const inquiryContent = elements.form.content?.value.trim() || '';

        // ì…ë ¥ê°’ ê²€ì¦
        const validation = validateInput(seatNumber, inquiryContent);
        if (!validation.valid) {
          showMessage(elements.messages.error, validation.message);
          const focusElement = validation.field === 'seat' ? elements.form.seatNumber : elements.form.content;
          focusElement?.focus();
          return;
        }

        // ì „ì†¡ ìƒíƒœ ì„¤ì •
        state.isSubmitting = true;
        const originalHtml = elements.form.submitButton?.innerHTML || '';
        if (elements.form.submitButton) {
          elements.form.submitButton.disabled = true;
          elements.form.submitButton.innerHTML = '<span class="inline-block animate-spin mr-2">â³</span>ì „ì†¡ ì¤‘...';
        }

        try {
          const payload = {
            branchId: state.selectedBranch,
            branchName: state.selectedBranchName,
            typeId: state.selectedType,
            typeName: state.selectedTypeName,
            typeIcon: state.selectedTypeIcon,
            seatNumber: seatNumber,
            content: inquiryContent,
            timestamp: new Date().toISOString()
          };

          // API í˜¸ì¶œ (ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜)
          const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
          
          if (isDevelopment) {
            // ê°œë°œ í™˜ê²½: ì½˜ì†”ì— ì¶œë ¥í•˜ê³  ì„±ê³µ ì‹œë®¬ë ˆì´ì…˜
            console.log('ğŸ“¬ ë¬¸ì˜ ë‚´ìš© (ê°œë°œ ëª¨ë“œ):', payload);
            await new Promise(resolve => setTimeout(resolve, 1000)); // 1ì´ˆ ëŒ€ê¸°
            showMessage(elements.messages.success);
            setTimeout(() => goToPage('branch'), 2000);
          } else {
            // í”„ë¡œë•ì…˜ í™˜ê²½: ì‹¤ì œ API í˜¸ì¶œ
            const response = await fetch('/api/inquiry', {
              method: 'POST',
              headers: { 
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
              },
              body: JSON.stringify(payload)
            });

            if (!response.ok) {
              const data = await response.json().catch(() => ({}));
              throw new Error(data?.message || `ì„œë²„ ì˜¤ë¥˜ (${response.status})`);
            }

            showMessage(elements.messages.success);
            setTimeout(() => goToPage('branch'), 2000);
          }
        } catch (error) {
          console.error('âŒ ë¬¸ì˜ ì œì¶œ ì˜¤ë¥˜:', error);
          showMessage(elements.messages.error, 'ë¬¸ì˜ ì ‘ìˆ˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        } finally {
          state.isSubmitting = false;
          if (elements.form.submitButton) {
            elements.form.submitButton.disabled = false;
            elements.form.submitButton.innerHTML = originalHtml;
          }
        }
      }

      // Public API
      return {
        init,
        goToPage,
        selectBranch,
        selectType,
        submitInquiry
      };
    })();

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', app.init);
    } else {
      app.init();
    }
  </script>
</body>
</html>
